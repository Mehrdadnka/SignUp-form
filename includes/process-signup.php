<?php
    /*
    =========================================================================================================
    Empty name input check
    =========================================================================================================
    */
    if(empty($_POST["name"]))
    {
        die("Name is required");
    }
    /*
    =========================================================================================================
    Email validation filter
    =========================================================================================================
    */
    if(!filter_var($_POST["email"], FILTER_VALIDATE_EMAIL))
    {
        die("Valide email is required");   
    }
    /*
    =========================================================================================================
    Password check
    =========================================================================================================
    */
    if(strlen($_POST["password"]) < 8)
    {
        die("Password must be at least 8 characters");
    }
    /*
    =========================================================================================================
    Check if password dont have any lower case letters
    =========================================================================================================
    */
    if(!preg_match("/[a-z]/i", $_POST["password"]))
    {
        die("Password must contain at least one lower case letter");
    }
    /*
    =========================================================================================================
    Check if password dont have any upper case letters
    =========================================================================================================
    */
    if(!preg_match("/[A-Z]/i", $_POST["password"]))
    {
        die("Password must contain at least one upper case letter");
    }
    /*
    =========================================================================================================
    Check if password dont have any number
    =========================================================================================================
    */
    if(!preg_match("/[0-9]/", $_POST["password"]))
    {
        die("Password must contain at least one number");
    }
    /*
    =========================================================================================================
    Check if password is the same as password repeat
    =========================================================================================================
    */
    if($_POST["password"] !== $_POST["password_confirmation"])
    {
        die("Passwords must be matched");
    }
    /*
    =========================================================================================================
    Password scurity (hashing)
    =========================================================================================================
    */
    $password_hash = password_hash($_POST["password"], PASSWORD_DEFAULT);
    /*
    =========================================================================================================
    Asignment the database.php file to a variable called result
    (connect to database)
    =========================================================================================================
    */
    $mysqli = require __DIR__ ."/includes/database.php";
    /*
    =========================================================================================================
    Creating database queries
    =========================================================================================================
    */
    $sql = "INSERT INTO user (`name`, `email`, `password_hash`) VALUES (?, ?, ?)";
    /*
    =========================================================================================================
    Initialising sql prepared statement for sql connection object
    Avoiding the sql injection
    =========================================================================================================
    */
    $stmt = $mysqli->stmt_init();
    /*
    =========================================================================================================
    Prepare the sql stmt for execution
    (Check the problems of sql server)
    =========================================================================================================
    */
    if(!$stmt->prepare($sql))
    {
        die("SQL error: " . $mysqli->error);
    }
    /*
    =========================================================================================================
    Bind values to the placeholder characters
    =========================================================================================================
    */
    $stmt->bind_param( "sss", 
                       $_POST["name"],
                       $_POST["email"],
                       $password_hash);
    /*
    =========================================================================================================
    Executing the statement and signing up
    Check for email uniqueness
    =========================================================================================================
    */
    if($stmt->execute())
    {
        echo "Sign up successfull";
    }else {
        
        die($mysqli -> error . " " . $mysqli -> errno);
    }
        
    
    /*
    =========================================================================================================
    Signing up  
    if (!$mysqli->errno) 
        {
            die("Error message: %s\n". $mysqli->error);
        }
        else
        {
    =========================================================================================================
    */
    
?>